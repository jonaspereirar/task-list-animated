(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[277],{3962:function(e,r,a){(window.__NEXT_P=window.__NEXT_P||[]).push(["/profile",function(){return a(2794)}])},2794:function(e,r,a){"use strict";a.r(r);var s=a(4051),t=a.n(s),n=a(5893),o=a(9008),c=a(7294),i=a(6597),l=a(1664),d=a(3517),u=a(9692),p=a(7451);function m(e,r,a,s,t,n,o){try{var c=e[n](o),i=c.value}catch(l){return void a(l)}c.done?r(i):Promise.resolve(i).then(s,t)}function f(e,r,a){return r in e?Object.defineProperty(e,r,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[r]=a,e}function h(e){for(var r=1;r<arguments.length;r++){var a=null!=arguments[r]?arguments[r]:{},s=Object.keys(a);"function"===typeof Object.getOwnPropertySymbols&&(s=s.concat(Object.getOwnPropertySymbols(a).filter((function(e){return Object.getOwnPropertyDescriptor(a,e).enumerable})))),s.forEach((function(r){f(e,r,a[r])}))}return e}r.default=function(){var e=(0,c.useState)({avatar:"",name:"",password:"",cf_password:""}),r=e[0],a=e[1],s=r.avatar,x=r.name,v=r.password,j=r.cf_password,y=(0,c.useContext)(i.R),N=y.state,w=y.dispatch,b=N.auth,g=N.notify,_=N.orders;(0,c.useEffect)((function(){b.user&&a(h({},r,{name:b.user.name}))}),[b.user]);var O=function(e){var s=e.target,t=s.name,n=s.value;a(h({},r,f({},t,n))),w({type:"NOTIFY",payload:{}})},k=function(){w({type:"NOTIFY",payload:{loading:!0}}),(0,u.B6)("user/resetPassword",{password:v},b.token).then((function(e){return e.err?w({type:"NOTIFY",payload:{error:e.err}}):w({type:"NOTIFY",payload:{success:e.msg}})}))},P=function(){var e,r=(e=t().mark((function e(){var r;return t().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(w({type:"NOTIFY",payload:{loading:!0}}),!s){e.next=6;break}return e.next=5,(0,p.E)([s]);case 5:r=e.sent;case 6:(0,u.B6)("user",{name:x,avatar:s?r[0].url:b.user.avatar},b.token).then((function(e){return e.err?w({type:"NOTIFY",payload:{error:e.err}}):(w({type:"AUTH",payload:{token:b.token,user:e.user}}),w({type:"NOTIFY",payload:{success:e.msg}}))}));case 7:case"end":return e.stop()}}),e)})),function(){var r=this,a=arguments;return new Promise((function(s,t){var n=e.apply(r,a);function o(e){m(n,s,t,o,c,"next",e)}function c(e){m(n,s,t,o,c,"throw",e)}o(void 0)}))});return function(){return r.apply(this,arguments)}}();return b.user?(0,n.jsxs)("div",{className:"profile_page",children:[(0,n.jsxs)(o.default,{children:[(0,n.jsx)("title",{children:"Profile"}),(0,n.jsx)("meta",{name:"facebook-domain-verification",content:"wrs2vl5k2z6jg7z3jggsa9cv2hzif3"})]}),(0,n.jsxs)("section",{className:"row text-secondary my-3",children:[(0,n.jsxs)("div",{className:"col-md-4",children:[(0,n.jsx)("h3",{className:"text-center text-uppercase",children:"user"===b.user.role?"User Profile":"Admin Profile"}),(0,n.jsxs)("div",{className:"avatar",children:[(0,n.jsx)("img",{src:s?URL.createObjectURL(s):b.user.avatar,alt:"avatar"}),(0,n.jsxs)("span",{children:[(0,n.jsx)("i",{className:"fas fa-camera"}),(0,n.jsx)("p",{children:"Change"}),(0,n.jsx)("input",{type:"file",name:"file",id:"file_up",accept:"image/*",onChange:function(e){var s=e.target.files[0];return s?s.size>1048576?w({type:"NOTIFY",payload:{error:"The largest image size is 1mb."}}):"image/jpeg"!==s.type&&"image/png"!==s.type?w({type:"NOTIFY",payload:{error:"Image format is incorrect."}}):void a(h({},r,{avatar:s})):w({type:"NOTIFY",payload:{error:"File does not exist."}})}})]})]}),(0,n.jsxs)("div",{className:"form-group",children:[(0,n.jsx)("label",{htmlFor:"name",children:"Name"}),(0,n.jsx)("input",{type:"text",name:"name",value:x,className:"form-control",placeholder:"Your name",onChange:O})]}),(0,n.jsxs)("div",{className:"form-group",children:[(0,n.jsx)("label",{htmlFor:"email",children:"Email"}),(0,n.jsx)("input",{type:"text",name:"email",defaultValue:b.user.email,className:"form-control",disabled:!0})]}),(0,n.jsxs)("div",{className:"form-group",children:[(0,n.jsx)("label",{htmlFor:"password",children:"New Password"}),(0,n.jsx)("input",{type:"password",name:"password",value:v,className:"form-control",placeholder:"Your new password",onChange:O})]}),(0,n.jsxs)("div",{className:"form-group",children:[(0,n.jsx)("label",{htmlFor:"cf_password",children:"Confirm New Password"}),(0,n.jsx)("input",{type:"password",name:"cf_password",value:j,className:"form-control",placeholder:"Confirm new password",onChange:O})]}),(0,n.jsx)("button",{className:"btn btn-info",disabled:g.loading,onClick:function(e){if(e.preventDefault(),v){var r=(0,d.Z)(x,b.user.email,v,j);if(r)return w({type:"NOTIFY",payload:{error:r}});k()}(x!==b.user.name||s)&&P()},children:"Update"})]}),(0,n.jsxs)("div",{className:"col-md-8",children:[(0,n.jsx)("h3",{className:"text-uppercase",children:"Orders"}),(0,n.jsx)("div",{className:"my-3 table-responsive",children:(0,n.jsxs)("table",{className:"table-bordered table-hover w-100 text-uppercase",style:{minWidth:"600px",cursor:"pointer"},children:[(0,n.jsx)("thead",{className:"bg-light font-weight-bold",children:(0,n.jsxs)("tr",{children:[(0,n.jsx)("td",{className:"p-2",children:"id"}),(0,n.jsx)("td",{className:"p-2",children:"date"}),(0,n.jsx)("td",{className:"p-2",children:"total"}),(0,n.jsx)("td",{className:"p-2",children:"delivered"}),(0,n.jsx)("td",{className:"p-2",children:"paid"})]})}),(0,n.jsx)("tbody",{children:_.map((function(e){return(0,n.jsxs)("tr",{children:[(0,n.jsx)("td",{className:"p-2",children:(0,n.jsx)(l.default,{href:"/order/".concat(e._id),children:(0,n.jsx)("a",{children:e._id})})}),(0,n.jsx)("td",{className:"p-2",children:new Date(e.createdAt).toLocaleDateString()}),(0,n.jsxs)("td",{className:"p-2",children:["$",e.total]}),(0,n.jsx)("td",{className:"p-2",children:e.delivered?(0,n.jsx)("i",{className:"fas fa-check text-success"}):(0,n.jsx)("i",{className:"fas fa-times text-danger"})}),(0,n.jsx)("td",{className:"p-2",children:e.paid?(0,n.jsx)("i",{className:"fas fa-check text-success"}):(0,n.jsx)("i",{className:"fas fa-times text-danger"})})]},e._id)}))})]})})]})]})]}):null}},7451:function(e,r,a){"use strict";a.d(r,{E:function(){return o}});var s=a(4051),t=a.n(s);function n(e,r,a,s,t,n,o){try{var c=e[n](o),i=c.value}catch(l){return void a(l)}c.done?r(i):Promise.resolve(i).then(s,t)}var o=function(){var e,r=(e=t().mark((function e(r){var a,s,n,o,c,i,l,d,u,p;return t().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:a=[],s=!0,n=!1,o=void 0,e.prev=2,c=r[Symbol.iterator]();case 4:if(s=(i=c.next()).done){e.next=20;break}return l=i.value,(d=new FormData).append("file",l),d.append("upload_preset","anapessoaecommerce"),d.append("cloud_name","jonasprodrigues"),e.next=12,fetch("https://api.cloudinary.com/v1_1/jonasprodrigues/upload",{method:"POST",body:d});case 12:return u=e.sent,e.next=15,u.json();case 15:p=e.sent,a.push({public_id:p.public_id,url:p.secure_url});case 17:s=!0,e.next=4;break;case 20:e.next=26;break;case 22:e.prev=22,e.t0=e.catch(2),n=!0,o=e.t0;case 26:e.prev=26,e.prev=27,s||null==c.return||c.return();case 29:if(e.prev=29,!n){e.next=32;break}throw o;case 32:return e.finish(29);case 33:return e.finish(26);case 34:return e.abrupt("return",a);case 35:case"end":return e.stop()}}),e,null,[[2,22,26,34],[27,,29,33]])})),function(){var r=this,a=arguments;return new Promise((function(s,t){var o=e.apply(r,a);function c(e){n(o,s,t,c,i,"next",e)}function i(e){n(o,s,t,c,i,"throw",e)}c(void 0)}))});return function(e){return r.apply(this,arguments)}}()},3517:function(e,r){"use strict";r.Z=function(e,r,a,s){return e&&r&&a?function(e){return/^(([^<>()[\]\\.,;:\s@\"]+(\.[^<>()[\]\\.,;:\s@\"]+)*)|(\".+\"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/.test(e)}(r)?a.length<6?"A senha deve ter pelo menos 6 caracteres.":a!==s?"Confirmar senha n\xe3o corresponde.":void 0:"E-mail inv\xe1lido.":"Por favor, preencha todos os campos."}}},function(e){e.O(0,[774,888,179],(function(){return r=3962,e(e.s=r);var r}));var r=e.O();_N_E=r}]);