(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[441],{9869:function(e,t,r){(window.__NEXT_P=window.__NEXT_P||[]).push(["/order/[id]",function(){return r(8814)}])},8814:function(e,t,r){"use strict";r.r(t),r.d(t,{default:function(){return h}});var n=r(5893),a=r(9008),i=r(7294),s=r(6597),c=r(1163),d=r(1664),l=r(9692),o=r(1374);function u(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}var p=function(e){var t=e.order,r=(0,i.useRef)(),a=(0,i.useContext)(s.R),c=a.state,d=a.dispatch,p=c.auth,f=c.orders;return(0,i.useEffect)((function(){paypal.Buttons({createOrder:function(e,r){return r.order.create({purchase_units:[{amount:{value:t.total}}]})},onApprove:function(e,r){return d({type:"NOTIFY",payload:{loading:!0}}),r.order.capture().then((function(e){(0,l.B6)("order/payment/".concat(t._id),{paymentId:e.payer.payer_id},p.token).then((function(r){return r.err?d({type:"NOTIFY",payload:{error:r.err}}):(d((0,o.$G)(f,t._id,function(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{},n=Object.keys(r);"function"===typeof Object.getOwnPropertySymbols&&(n=n.concat(Object.getOwnPropertySymbols(r).filter((function(e){return Object.getOwnPropertyDescriptor(r,e).enumerable})))),n.forEach((function(t){u(e,t,r[t])}))}return e}({},t,{paid:!0,dateOfPayment:e.create_time,paymentId:e.payer.payer_id,method:"Paypal"}),"ADD_ORDERS")),d({type:"NOTIFY",payload:{success:r.msg}}))}))}))}}).render(r.current)}),[]),(0,n.jsx)("div",{ref:r})};function f(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}var m=function(e){var t=e.orderDetail,r=e.state,a=e.dispatch,i=r.auth,s=r.orders,c=function(e){a({type:"NOTIFY",payload:{loading:!0}}),(0,l.B6)("order/delivered/".concat(e._id),null,i.token).then((function(t){if(t.err)return a({type:"NOTIFY",payload:{error:t.err}});var r=t.result,n=r.paid,i=r.dateOfPayment,c=r.method,d=r.delivered;return a((0,o.$G)(s,e._id,function(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{},n=Object.keys(r);"function"===typeof Object.getOwnPropertySymbols&&(n=n.concat(Object.getOwnPropertySymbols(r).filter((function(e){return Object.getOwnPropertyDescriptor(r,e).enumerable})))),n.forEach((function(t){f(e,t,r[t])}))}return e}({},e,{paid:n,dateOfPayment:i,method:c,delivered:d}),"ADD_ORDERS")),a({type:"NOTIFY",payload:{success:t.msg}})}))};return i.user?(0,n.jsx)(n.Fragment,{children:t.map((function(e){return(0,n.jsxs)("div",{style:{margin:"20px auto"},className:"row justify-content-around",children:[(0,n.jsxs)("div",{className:"text-uppercase my-3",style:{maxWidth:"600px"},children:[(0,n.jsxs)("h2",{className:"text-break",children:["Order ",e._id]}),(0,n.jsxs)("div",{className:"mt-4 text-secondary",children:[(0,n.jsx)("h3",{children:"Shipping"}),(0,n.jsxs)("p",{children:["Name: ",e.user.name]}),(0,n.jsxs)("p",{children:["Email: ",e.user.email]}),(0,n.jsxs)("p",{children:["Address: ",e.address]}),(0,n.jsxs)("p",{children:["Mobile: ",e.mobile]}),(0,n.jsxs)("div",{className:"alert ".concat(e.delivered?"alert-success":"alert-danger","\n                        d-flex justify-content-between align-items-center"),role:"alert",children:[e.delivered?"Deliverd on ".concat(e.updatedAt):"Not Delivered","admin"===i.user.role&&!e.delivered&&(0,n.jsx)("button",{className:"btn btn-dark text-uppercase",onClick:function(){return c(e)},children:"Mark as delivered"})]}),(0,n.jsx)("h3",{children:"Payment"}),e.method&&(0,n.jsxs)("h6",{children:["Method: ",(0,n.jsx)("em",{children:e.method})]}),e.paymentId&&(0,n.jsxs)("p",{children:["PaymentId: ",(0,n.jsx)("em",{children:e.paymentId})]}),(0,n.jsx)("div",{className:"alert ".concat(e.paid?"alert-success":"alert-danger","\n                        d-flex justify-content-between align-items-center"),role:"alert",children:e.paid?"Paid on ".concat(e.dateOfPayment):"Not Paid"}),(0,n.jsxs)("div",{children:[(0,n.jsx)("h3",{children:"Order Items"}),e.cart.map((function(e){return(0,n.jsxs)("div",{className:"row border-bottom mx-0 p-2 justify-content-betwenn align-items-center",style:{maxWidth:"550px"},children:[(0,n.jsx)("img",{src:e.images[0].url,alt:e.images[0].url,style:{width:"50px",height:"45px",objectFit:"cover"}}),(0,n.jsx)("h5",{className:"flex-fill text-secondary px-3 m-0",children:(0,n.jsx)(d.default,{href:"/product/".concat(e._id),children:(0,n.jsx)("a",{children:e.title})})}),(0,n.jsxs)("span",{className:"text-info m-0",children:[e.quantity," x \u20ac",e.price," = \u20ac",e.price*e.quantity]})]},e._id)}))]})]})]}),!e.paid&&"admin"!==i.user.role&&(0,n.jsxs)("div",{className:"p-4",children:[(0,n.jsxs)("h2",{className:"mb-4 text-uppercase",children:["Total: \u20ac",e.total]}),(0,n.jsx)(p,{order:e})]})]},e._id)}))}):null},h=function(){var e=(0,i.useContext)(s.R),t=e.state,r=e.dispatch,d=t.orders,l=t.auth,o=(0,c.useRouter)(),u=(0,i.useState)([]),p=u[0],f=u[1];return(0,i.useEffect)((function(){var e=d.filter((function(e){return e._id===o.query.id}));f(e)}),[d]),l.user?(0,n.jsxs)("div",{className:"my-3",children:[(0,n.jsx)(a.default,{children:(0,n.jsx)("title",{children:"Detail Orders"})}),(0,n.jsx)("div",{children:(0,n.jsxs)("button",{className:"btn btn-dark",onClick:function(){return o.back()},children:[(0,n.jsx)("i",{className:"fas fa-long-arrow-alt-left","aria-hidden":"true"})," Voltar"]})}),(0,n.jsx)(m,{orderDetail:p,state:t,dispatch:r})]}):null}}},function(e){e.O(0,[774,888,179],(function(){return t=9869,e(e.s=t);var t}));var t=e.O();_N_E=t}]);